#!/bin/bash

set -e

ENV_FILE=".env"

# Step 1: Ensure .env exists, or create it interactively
if [ ! -f "$ENV_FILE" ]; then
  read -rp "Enter your Biteral API key: " user_api_key

  if [ -z "$user_api_key" ]; then
    echo "❌ No API key entered. Aborting."
    exit 1
  fi

  echo "export BITERAL_API_KEY=$user_api_key" > "$ENV_FILE"
fi

# Step 2: Load .env
source "$ENV_FILE"

show_available_examples() {
  echo ""
  echo "Available examples:"
  for file in examples/*.php; do
    base=$(basename "${file%.php}")
    if [ "$base" != "bootstrap" ]; then
      echo "$base"
    fi
  done
  echo ""
}

if [ -z "$1" ]; then
  echo "Usage: ./bin/example <example-name>"
  show_available_examples
  exit 1
fi

example_name="$1"
example_path="examples/$example_name"

if [ ! -f "$example_path" ]; then
  example_path="examples/${example_name}.php"
fi

if [ ! -f "$example_path" ]; then
  echo "❌ Example file not found: $1"
  show_available_examples
  exit 1
fi

php "$example_path"
